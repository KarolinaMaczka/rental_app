{% load static %}

<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/register.css' %}">
</head>

<header>
    {% include 'header.html' %}
    <script>
        function changeHeaderClass() {
            var header = document.querySelector('.header-with-gradient');
            if (header) {
                header.className = 'normal-header';
            }
        }
        changeHeaderClass();
    </script>
</header>

<body>
<div id="content">

    <h1>Create Reservation</h1>
    <form method="post" id="reservationForm" data-rental-id="{{ rental.id }}" class="standard-form">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Book Reservation</button>
    </form>

    {% if messages %}
        {% for message in messages %}
            <div class="alert {{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
</div>


<script>
    document.getElementById('reservationForm').addEventListener('submit', function(event) {
        var startDate = new Date(document.getElementsByName('start_date')[0].value);
        var endDate = new Date(document.getElementsByName('end_date')[0].value);
        var today = new Date();
        today.setHours(0, 0, 0, 0); // Reset time to 00:00

        if (startDate < today) {
            event.preventDefault();
            alert('Start date must be after today.');
        } else if (endDate <= startDate) {
            event.preventDefault();
            alert('End date must be after start date.');
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        var rentalId = document.getElementById('reservationForm').getAttribute('data-rental-id');

        fetch('/get_booked_dates/' + rentalId)
            .then(response => response.json())
            .then(data => {
                let bookedDates = data.booked_dates;
                let datepickerOptions = {
                    beforeShowDay: function(date) {
                        for (let i = 0; i < bookedDates.length; i++) {
                            let start = new Date(bookedDates[i].start_date);
                            let end = new Date(bookedDates[i].end_date);
                            if (date >= start && date <= end) {
                                return [false];
                            }
                        }
                        return [true];
                    }
                };
                $(".datepicker").datepicker(datepickerOptions);
            });
    });

</script>

